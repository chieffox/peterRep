<?phpdefined("IN_IA") or exit("Access Denied");class GTF_cybModuleSite extends WeModuleSite {    public function doMobileindex() {        global $_GPC, $_W;        $weid = $_W['uniacid'];			$item = pdo_fetch("SELECT * FROM ".tablename('gtf_cyb_shezhi')." WHERE weid = :weid ", array(':weid' => $weid));				$date = array();				$date['weid'] = $weid;		$date['openid'] = $_W['fans']['from_user'];		$date['realname'] = $_W['fans']['nickname'];		$date['touxiang'] = $_W['fans']['headimgurl'];		$date['zc_time'] = time();						$re = pdo_fetch("SELECT * FROM ".tablename('gtf_cyb_yonghu')." WHERE openid = :openid and weid = :weid ", array(':openid' => $date['openid'],':weid' => $weid));				if(empty($re)){			 pdo_insert('gtf_cyb_yonghu', $date);		}				if($_GPC['op'] == 'jieshu'){			$jilu = pdo_fetch("SELECT * FROM ".tablename('gtf_cyb_paihang')." WHERE khid = :khid and weid = :weid ", array(':khid' => $re['id'],':weid' => $weid));						$da = array(				'weid' => $weid,				'khid' => $re['id'],				'realname' => $re['realname'],				'num' => $_GPC['num']			);						if($jilu){				pdo_update('gtf_cyb_paihang',$da, array('weid' => $weid,'khid'=>$re['id']));			}else{				pdo_insert('gtf_cyb_paihang', $da);			}		}		        include $this->template('index');    }			public function doMobilepaihang() {        global $_GPC, $_W;        $weid = $_W['uniacid'];		$item = pdo_fetch("SELECT * FROM ".tablename('gtf_cyb_shezhi')." WHERE weid = :weid ", array(':weid' => $weid));		$paihang = pdo_fetchall("SELECT * FROM ".tablename('gtf_cyb_paihang')." WHERE lh = 0 and  weid = :weid order by num desc limit 0,10", array(':weid' => $weid));		        include $this->template('paihang');    }				public function doWebsetting() {        global $_GPC, $_W;        $weid = $_W['uniacid'];				$item = pdo_fetch("SELECT * FROM ".tablename('gtf_cyb_shezhi')." WHERE weid = :weid ", array(':weid' => $weid));				if (checksubmit('submit')){						$data = array(				'weid' => $weid,				'fxtitle' => $_GPC['title'],				'fxneirong' => $_GPC['content'],				'fxtupian' => $_GPC['thumb'],				'fxerweima' => $_GPC['icon']			);						if($item){				pdo_update('gtf_cyb_shezhi',$data, array('weid' => $weid));			}else{				pdo_insert('gtf_cyb_shezhi', $data);			}		} 							        include $this->template('setting');    }			public function doWebyonghu() {        global $_GPC, $_W;        $weid = $_W['uniacid'];				$yonghu = pdo_fetchall("SELECT * FROM ".tablename('gtf_cyb_yonghu')." WHERE weid = :weid ", array(':weid' => $weid));				if($_GPC['op'] == 'lahei'){			pdo_update('gtf_cyb_paihang',array('lh'=>1),array('khid'=>$_GPC['id']));		}		        include $this->template('yonghu');    }		public function doWebpaihang() {        global $_GPC, $_W;        $weid = $_W['uniacid'];				$paihang = pdo_fetchall("SELECT * FROM ".tablename('gtf_cyb_paihang')." WHERE weid = :weid ", array(':weid' => $weid));		        include $this->template('paihangbang');    }    public function doMobiletest(){    	global $_GPC, $_W;        $uniacid = $_W['uniacid'];                $mc = mc_oauth_userinfo();        if(!empty($mc['unionid'])){        	$fans = pdo_fetch('SELECT follow FROM ims_mc_mapping_fans WHERE uniacid='.$uniacid.' AND unionid="'.$mc['unionid'].'"');        } else {        	$fans = pdo_fetch('SELECT follow FROM ims_mc_mapping_fans WHERE uniacid='.$uniacid.' AND openid="'.$mc['openid'].'"');        }        // if($uniacid == 21){        // 	echo $fans['follow'];        // }        $res = pdo_fetch('SELECT * FROM ims_gtf_cyb_hequn_test WHERE uniacid='.$uniacid.' AND openid="'.$mc['openid'].'"');        if($res){        	if($res['subscribe'] != $fans['follow']){        		pdo_query('UPDATE ims_gtf_cyb_hequn_test SET subscribe='.$fans['follow'].' WHERE uniacid='.$uniacid.' AND openid="'.$mc['openid'].'"');        	}        } else {        	$sql = 'INSERT INTO ims_gtf_cyb_hequn_test VALUES ("", '.$uniacid.', "'.$mc['openid'].'", "'.$mc['unionid'].'", "'.$mc['avatar'].'", "'.$mc['nickname'].'", '.time().', 0, '.$fans['follow'].')';        	pdo_query($sql);        }        $assets = '/addons/gtf_cyb/template/mobile/test_items/';    	include $this->template('hequn_test');    }  public function doMobileHougongzhuan(){    	global $_GPC, $_W;        $uniacid = $_W['uniacid'];                $mc = mc_oauth_userinfo();        if(!empty($mc['unionid'])){        	$fans = pdo_fetch('SELECT follow FROM ims_mc_mapping_fans WHERE uniacid='.$uniacid.' AND unionid="'.$mc['unionid'].'"');        } else {        	$fans = pdo_fetch('SELECT follow FROM ims_mc_mapping_fans WHERE uniacid='.$uniacid.' AND openid="'.$mc['openid'].'"');        }             	include $this->template('hougongzhuan');    }}